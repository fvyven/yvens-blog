<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="shortcut icon" href="/favicon.ico"> <title>[Database] Mysql æœ€å·¦åŒ¹é…åŸåˆ™ - LanKE.e å©ªæ­Œ</title> <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet"> <link rel="stylesheet" href="/assets/dist/css/style.css"> <!-- <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_big-stone.min.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_white.min.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-base16.dark.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-github.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> --> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>[Database] Mysql æœ€å·¦åŒ¹é…åŸåˆ™ | LanKE.e å©ªæ­Œ</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="[Database] Mysql æœ€å·¦åŒ¹é…åŸåˆ™" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="æœ€å·¦åŒ¹é…åŸåˆ™ï¼ˆleftmost perfixï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘ä¸ºæœ€å·¦å‰ç¼€ï¼‰ï¼Œä¸€èˆ¬ç°åœ¨ç½‘ä¸Šé€šä¿—åŒ–çš„è§£é‡Šæ˜¯ï¼š åœ¨ MySQL å»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚" /> <meta property="og:description" content="æœ€å·¦åŒ¹é…åŸåˆ™ï¼ˆleftmost perfixï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘ä¸ºæœ€å·¦å‰ç¼€ï¼‰ï¼Œä¸€èˆ¬ç°åœ¨ç½‘ä¸Šé€šä¿—åŒ–çš„è§£é‡Šæ˜¯ï¼š åœ¨ MySQL å»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚" /> <link rel="canonical" href="https://lankee.blog/mysql-index-leftmost-prefix.html" /> <meta property="og:url" content="https://lankee.blog/mysql-index-leftmost-prefix.html" /> <meta property="og:site_name" content="LanKE.e å©ªæ­Œ" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-07-11T00:00:00+08:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="[Database] Mysql æœ€å·¦åŒ¹é…åŸåˆ™" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-07-11T00:00:00+08:00","datePublished":"2019-07-11T00:00:00+08:00","description":"æœ€å·¦åŒ¹é…åŸåˆ™ï¼ˆleftmost perfixï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘ä¸ºæœ€å·¦å‰ç¼€ï¼‰ï¼Œä¸€èˆ¬ç°åœ¨ç½‘ä¸Šé€šä¿—åŒ–çš„è§£é‡Šæ˜¯ï¼š åœ¨ MySQL å»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚","headline":"[Database] Mysql æœ€å·¦åŒ¹é…åŸåˆ™","mainEntityOfPage":{"@type":"WebPage","@id":"https://lankee.blog/mysql-index-leftmost-prefix.html"},"url":"https://lankee.blog/mysql-index-leftmost-prefix.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="content"> <header> <div class="main"> <a href="https://lankee.blog/">LanKE.e å©ªæ­Œ</a> </div> <nav> <a class='' href="/">é¦–é¡µ</a> <!-- <a class='' href="/archives.html"> Archives</a> --> <a class='' href="/about.html">å…³äº</a> </nav> </header> <hr class="light-hr"> <main> <div class="title"> <h1 class="title">[Database] Mysql æœ€å·¦åŒ¹é…åŸåˆ™</h1> <div class="meta"> <time datetime="11-07-2019">Jul 11 2019</time> </div> </div> <hr class="no-margin light-hr "> <p>æœ€å·¦åŒ¹é…åŸåˆ™ï¼ˆleftmost perfixï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘ä¸ºæœ€å·¦å‰ç¼€ï¼‰ï¼Œä¸€èˆ¬ç°åœ¨ç½‘ä¸Šé€šä¿—åŒ–çš„è§£é‡Šæ˜¯ï¼š</p> <blockquote> <p>åœ¨ MySQL å»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚</p> </blockquote> <p>å…¶å®è¿™ä¸ªè§£é‡Šä¼šè®©äººæä¸å¤ªæ¸…æ¥šå…·ä½“æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå†çœ‹çœ‹å®˜æ–¹æ–‡æ¡£æ˜¯æ€ä¹ˆæè¿°çš„ï¼ˆåœ¨ MySQL 5.7 Reference Manual - <a href="https://dev.mysql.com/doc/refman/5.7/en/multiple-column-indexes.html" target="_blank">8.3.6 Multiple-Column Indexes</a> ä¸€èŠ‚ä¸­ï¼‰ï¼š</p> <blockquote> <p>MySQL can use multiple-column indexes for queries that test all the columns in the index, or queries that test just the first column, the first two columns, the first three columns, and so on. If you specify the columns in the right order in the index definition, a single composite index can speed up several kinds of queries on the same table.</p> </blockquote> <p>ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼š</p> <blockquote> <p>MySQL å¯ä»¥ä½¿ç”¨è”åˆç´¢å¼•æ¥å¤„ç†æ¶‰åŠåˆ°ç´¢å¼•ä¸­çš„æ‰€æœ‰åˆ—æˆ–ä»…æ¶‰åŠç´¢å¼•ä¸­å‰å‡ åˆ—çš„æŸ¥è¯¢ã€‚å¦‚æœä½ æŒ‰æ­£ç¡®çš„é¡ºåºåœ¨ç´¢å¼•å®šä¹‰ä¸­æŒ‡å®šè¿™äº›åˆ—ï¼Œé‚£ä¹ˆè”åˆç´¢å¼•å°±å¯ä»¥åŠ é€ŸåŒä¸€å¼ è¡¨ä¸Šå¤šç§ç±»å‹çš„æŸ¥è¯¢ã€‚</p> </blockquote> <p>ä¸è®ºæ˜¯ç½‘ä¸Šä¸€èˆ¬çš„è§£é‡Šï¼Œè¿˜æ˜¯å®˜æ–¹æè¿°å…¶å®éƒ½æ¯”è¾ƒç®€å•ï¼Œä½†åœ¨å®é™…æŸ¥è¯¢è¿‡ç¨‹ä¸­æƒ…å†µå°±æ¯”è¾ƒå¤æ‚äº†ï¼Œé‚£ä¹ˆä¸‹é¢é€šè¿‡å‡ ä¸ª SQL æŸ¥è¯¢ä¾‹å­è¯•ç€ææ¸…æ¥šã€‚</p> <h2 id="æ¥ç‚¹-">æ¥ç‚¹ ğŸŒ°</h2> <p>å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•è¡¨ï¼Œç„¶åæ·»åŠ ä¸€ç‚¹æµ‹è¯•æ•°æ®ï¼ˆMysql ç‰ˆæœ¬ 5.7ï¼‰ï¼š</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- å»ºè¡¨</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`test_tb`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="nv">`col1`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`col2`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`col3`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`col4`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>  <span class="c1">-- ä¸»é”®ç´¢å¼•</span>
  <span class="k">KEY</span> <span class="nv">`idx1`</span> <span class="p">(</span><span class="nv">`col1`</span><span class="p">,</span><span class="nv">`col2`</span><span class="p">,</span><span class="nv">`col3`</span><span class="p">)</span>   <span class="c1">-- è”åˆç´¢å¼•</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">11</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>

<span class="c1">-- æµ‹è¯•æ•°æ®</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span><span class="nv">"102"</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">104</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">202</span><span class="p">,</span><span class="nv">"202"</span><span class="p">,</span><span class="mi">203</span><span class="p">,</span><span class="mi">204</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">301</span><span class="p">,</span><span class="nv">"302"</span><span class="p">,</span><span class="mi">303</span><span class="p">,</span><span class="mi">304</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span><span class="nv">"402"</span><span class="p">,</span><span class="mi">403</span><span class="p">,</span><span class="mi">404</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">501</span><span class="p">,</span><span class="nv">"502"</span><span class="p">,</span><span class="mi">503</span><span class="p">,</span><span class="mi">504</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">601</span><span class="p">,</span><span class="nv">"602"</span><span class="p">,</span><span class="mi">603</span><span class="p">,</span><span class="mi">604</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">701</span><span class="p">,</span><span class="nv">"702"</span><span class="p">,</span><span class="mi">703</span><span class="p">,</span><span class="mi">704</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">801</span><span class="p">,</span><span class="nv">"802"</span><span class="p">,</span><span class="mi">803</span><span class="p">,</span><span class="mi">804</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">901</span><span class="p">,</span><span class="nv">"902"</span><span class="p">,</span><span class="mi">903</span><span class="p">,</span><span class="mi">904</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test_tb</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">,</span><span class="n">col4</span><span class="p">)</span> <span class="n">VALUE</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="nv">"1002"</span><span class="p">,</span><span class="mi">1003</span><span class="p">,</span><span class="mi">1004</span><span class="p">);</span>
</code></pre></div></div> <p>å…ˆçœ‹ä¸‹é¢å‡ æ¡ SQL çš„æ‰§è¡Œåˆ†æç»“æœï¼š</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; explain select * from test_tb where col1 = 1;  --ç´¢å¼•ç”Ÿæ•ˆ
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref   | rows | filtered | Extra |
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-------+
|  1 | SIMPLE      | test_tb | NULL       | ref  | idx1          | idx1 | 5       | const |    1 |   100.00 | NULL  |
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-------+
1 row in set, 1 warning (0.00 sec)

mysql&gt; explain select * from test_tb where col1 = 1 and col2 = '2';  --ç´¢å¼•ç”Ÿæ•ˆ
+----+-------------+---------+------------+------+---------------+------+---------+-------------+------+----------+-------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref         | rows | filtered | Extra |
+----+-------------+---------+------------+------+---------------+------+---------+-------------+------+----------+-------+
|  1 | SIMPLE      | test_tb | NULL       | ref  | idx1          | idx1 | 104     | const,const |    1 |   100.00 | NULL  |
+----+-------------+---------+------------+------+---------------+------+---------+-------------+------+----------+-------+
1 row in set, 1 warning (0.00 sec)

mysql&gt; explain select * from test_tb where col1 = 1 and col2 = '2' and col3 = 3;  --ç´¢å¼•ç”Ÿæ•ˆ
+----+-------------+---------+------------+------+---------------+------+---------+-------------------+------+----------+-------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref               | rows | filtered | Extra |
+----+-------------+---------+------------+------+---------------+------+---------+-------------------+------+----------+-------+
|  1 | SIMPLE      | test_tb | NULL       | ref  | idx1          | idx1 | 109     | const,const,const |    1 |   100.00 | NULL  |
+----+-------------+---------+------------+------+---------------+------+---------+-------------------+------+----------+-------+
1 row in set, 1 warning (0.01 sec)

mysql&gt; explain select * from test_tb where col2 = '2' and col1 = 1 and col3 = 3;  --ç´¢å¼•ç”Ÿæ•ˆ
+----+-------------+---------+------------+------+---------------+------+---------+-------------------+------+----------+-------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref               | rows | filtered | Extra |
+----+-------------+---------+------------+------+---------------+------+---------+-------------------+------+----------+-------+
|  1 | SIMPLE      | test_tb | NULL       | ref  | idx1          | idx1 | 109     | const,const,const |    1 |   100.00 | NULL  |
+----+-------------+---------+------------+------+---------------+------+---------+-------------------+------+----------+-------+
1 row in set, 1 warning (0.01 sec)

mysql&gt; explain select * from test_tb where col2 = '2' and col3 = 3;  --ç´¢å¼•ä¸ç”Ÿæ•ˆ
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | test_tb | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   10 |    10.00 | Using where |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

mysql&gt; explain select * from test_tb where col3 = 3 and col1 = 1;  --åªæœ‰ col1 åˆ—ç´¢å¼•ç”Ÿæ•ˆ
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-----------------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref   | rows | filtered | Extra                 |
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-----------------------+
|  1 | SIMPLE      | test_tb | NULL       | ref  | idx1          | idx1 | 5       | const |    1 |    10.00 | Using index condition |
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-----------------------+
1 row in set, 1 warning (0.01 sec)
</code></pre></div></div> <p>æ ¹æ®åˆ†æç»“æœçš„ type åˆ—å’Œ ref åˆ—ï¼ˆExplain çš„è¯¦è§£å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html" target="_blank">8.8.2 EXPLAIN Output Format</a>ï¼‰å¯ä»¥å‘ç°ï¼Œ<strong>åªè¦æŸ¥è¯¢æ¡ä»¶ä¸­çš„ N åˆ—åŒ…å«äºè”åˆç´¢å¼•çš„æœ€å·¦è¿ç»­çš„ N åˆ—ï¼Œè”åˆç´¢å¼•å°±ä¼šç”Ÿæ•ˆã€‚</strong>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åˆ›å»º<strong>è”åˆç´¢å¼• <code class="language-plaintext highlighter-rouge">idx1(col1,col2,col3)</code>ï¼Œç›¸å½“äºåˆ›å»ºäº† <code class="language-plaintext highlighter-rouge">(col1)ã€(col1,col2)ã€(col1,col2,col3)</code> è¿™ä¸‰ä¸ªç´¢å¼•ã€‚</strong> ä¹Ÿå¯ä»¥å‘ç°<strong>æŸ¥è¯¢æ¡ä»¶ä¸­åˆ—é¡ºåºä¸ä¼šå½±å“ç´¢å¼•ç”Ÿæ•ˆ</strong>ï¼Œè¿™æ˜¯å› ä¸º <strong>Mysql çš„æŸ¥è¯¢ä¼˜åŒ–å™¨</strong>ï¼Œè¿™ç‚¹é¡ºåºé—®é¢˜è¿˜æ˜¯èƒ½è§£å†³çš„ã€‚</p> <p>ä½†æ˜¯ä¸‹é¢è¿™å¥ SQL çš„åˆ†æç»“æœï¼š</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; explain select col1,col2,col3 from test_tb where col2 ='2' and col3 = 3;
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+--------------------------+
| id | select_type | table   | partitions | type  | possible_keys | key  | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | test_tb | NULL       | index | NULL          | idx1 | 109     | NULL |   10 |    10.00 | Using where; Using index |
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.01 sec)
</code></pre></div></div> <p>å¯ä»¥çœ‹åˆ° type ä¸æ˜¯ NULLï¼Œè¯´æ˜æ˜¯èµ°äº†ç´¢å¼•çš„ï¼Œä½†æ˜¯è¿™ä¸ç¬¦åˆè”åˆç´¢å¼•éœ€è¦æœ€å·¦è¿ç»­åˆ—çš„å®šä¹‰ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p> <h3 id="è¦†ç›–ç´¢å¼•">è¦†ç›–ç´¢å¼•</h3> <p>æˆ‘ä»¬çŸ¥é“åœ¨ InnoDB ä¸­ï¼Œè¡¨éƒ½æ˜¯æ ¹æ®ä¸»é”®é¡ºåºä»¥ç´¢å¼•çš„å½¢å¼å­˜æ”¾çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨ã€‚è€Œ InnoDB ä½¿ç”¨äº† B+ æ ‘ï¼ˆæœ¬èŠ‚å¯¹ B+ æ ‘ä¸åšè¯¦è§£ï¼‰ç´¢å¼•æ¨¡å‹ï¼Œæ‰€ä»¥æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨ B+ æ ‘ä¸­çš„ã€‚æ ¹æ®å¶å­èŠ‚ç‚¹çš„å†…å®¹ï¼Œç´¢å¼•ç±»å‹åˆ†ä¸ºä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•ã€‚</p> <ul> <li>ä¸»é”®ç´¢å¼•ï¼ˆclustered indexï¼‰ä¹Ÿå°±æ˜¯<strong>èšç°‡ç´¢å¼•</strong>ï¼Œåœ¨å¶å­èŠ‚ç‚¹çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚<em><font style="color:#999">ï¼ˆæ³¨ï¼šèšç°‡ç´¢å¼•é»˜è®¤æ˜¯ä¸»é”®ï¼Œå¦‚æœè¡¨ä¸­æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼ŒInnoDB ä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼ŒInnoDB ä¼šéšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ã€‚ï¼‰</font></em></li> <li>éä¸»é”®ç´¢å¼•ï¼ˆsecondary indexï¼‰ä¹Ÿå°±æ˜¯<strong>äºŒçº§ç´¢å¼•</strong>ï¼Œåœ¨å¶å­èŠ‚ç‚¹çš„å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚</li> </ul> <p>æ‰€ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">select * from test_tb where id =1;</code> è¿™ç§ä¸»é”®æŸ¥è¯¢æ–¹å¼ï¼Œå°±åªéœ€è¦æŸ¥è¯¢ä¸»é”®ç´¢å¼•å¯¹åº”çš„é‚£æ£µæ ‘ã€‚è€Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">select * from test_tb where col1 = 1;</code> è¿™æ ·çš„éä¸»é”®ç´¢å¼•æŸ¥è¯¢æ–¹å¼ï¼Œå°±éœ€è¦å…ˆæŸ¥è¯¢ idx1 è¿™ä¸ªç´¢å¼•å¯¹åº”çš„é‚£æ£µæ ‘å¾—åˆ° id å€¼ä¹‹åï¼Œå†åˆ°ä¸»é”®ç´¢å¼•æ ‘æŸ¥è¯¢ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸º<strong>å›è¡¨</strong>ã€‚</p> <p>ä½¿ç”¨éä¸»é”®æŸ¥è¯¢éœ€è¦å¤šæ‰«æä¸€æ£µæ ‘ï¼Œä¼šé™ä½æŸ¥è¯¢æ•ˆç‡ï¼Œæ€ä¹ˆå°½é‡ä¸å›è¡¨å‘¢ï¼Ÿé™¤äº†ä¸»é”®æŸ¥è¯¢ï¼Œå°±æ˜¯<strong>è¦†ç›–ç´¢å¼•</strong>äº†ã€‚æ ¹æ®ä¸Šé¢çš„æ¦‚è¿°ï¼Œå¦‚æœäºŒçº§ç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™åªæŸ¥è¯¢æŸ¥è¯¢ç´¢å¼•é‡ŒåŒ…å«çš„å­—æ®µï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•ä¸­è¦†ç›–äº†ä½ æŸ¥è¯¢çš„å­—æ®µï¼Œé‚£å°±ä¸éœ€è¦å›è¡¨äº†ã€‚è¿™å°±è§£é‡Šäº†ä¸Šé¢çš„ç¤ºä¾‹ä¸ºä»€ä¹ˆæ˜¯èµ°äº†ç´¢å¼•çš„ï¼Œå› ä¸ºæŸ¥è¯¢çš„å­—æ®µåŒ…å«åœ¨è”åˆç´¢å¼• <code class="language-plaintext highlighter-rouge">idx1(col1,col2,col3)</code> ä¸­ï¼Œä¸éœ€è¦å›è¡¨ï¼Œä¹Ÿå°±æ˜¯è¦†ç›–ç´¢å¼•ã€‚</p> <h3 id="ä¸­æ–­åŒ¹é…ç´¢å¼•">ä¸­æ–­åŒ¹é…ç´¢å¼•</h3> <p>ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæœ€åä¸€æ¡ SQL æ¡ä»¶åˆ—ä¸è¿ç»­ä¼šä¸­æ–­ç´¢å¼•ï¼Œè¿˜æœ‰å“ªäº›æƒ…å†µä¼šä¸­æ–­è”åˆç´¢å¼•ï¼Œæœ€å¸¸è§çš„è¯´æ³•æ˜¯é‡åˆ°èŒƒå›´æŸ¥è¯¢å¦‚ï¼ˆ<code class="language-plaintext highlighter-rouge">&lt;,&gt;,between,like</code>ï¼‰å°±ä¼šä¸­æ–­åŒ¹é…ç´¢å¼•ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; explain select * from test_tb where col1 &gt; 1 and col2 = '2' and col3 = 3;
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | test_tb | NULL       | ALL  | idx1          | NULL | NULL    | NULL |   10 |    10.00 | Using where |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.01 sec)
</code></pre></div></div> <p>æ ¹æ®æµ‹è¯•ï¼Œç¡®å®å¦‚ <code class="language-plaintext highlighter-rouge">&lt;,&gt;,between,!=,not in</code> è¿™æ ·çš„èŒƒå›´æŸ¥è¯¢æ˜¯ä¼šä¸­æ–­åŒ¹é…çš„ï¼ˆå› ä¸ºç¯‡å¹…æ²¡æœ‰æŠŠæ‰€æœ‰æŸ¥è¯¢ç¤ºä¾‹åˆ—å‡ºï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±æ‰§è¡ŒæŸ¥çœ‹ï¼‰ï¼Œè™½ç„¶ in ä¹Ÿæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯ä¸ä¼šä¸­æ–­åŒ¹é…ï¼š</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; explain select * from test_tb where col1 in (1,2) and col2 = '2' and col3 = 3;  --(col1 = 1 or col1 =2)ç»“æœæ˜¯ä¸€æ ·çš„
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+
| id | select_type | table   | partitions | type  | possible_keys | key  | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | test_tb | NULL       | range | idx1          | idx1 | 109     | NULL |    2 |   100.00 | Using index condition |
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+
1 row in set, 1 warning (0.00 sec)
</code></pre></div></div> <p>ä½†æ˜¯ <code class="language-plaintext highlighter-rouge">like</code> çš„æƒ…å†µæœ‰äº›å¤æ‚ï¼š<br /> * æ³¨ï¼š<code class="language-plaintext highlighter-rouge">like</code> é»˜è®¤æ˜¯å·¦åŒ¹é…æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯ <code class="language-plaintext highlighter-rouge">like 'x'</code> ç­‰ä»·äº <code class="language-plaintext highlighter-rouge">like 'x%'</code>ã€‚<code class="language-plaintext highlighter-rouge">rlike</code> å°±æ˜¯å³åŒ¹é…æŸ¥è¯¢ã€‚</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; explain select * from test_tb where col1 = 1 and col2 like '1' and col3 = 3;  
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+
| id | select_type | table   | partitions | type  | possible_keys | key  | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | test_tb | NULL       | range | idx1          | idx1 | 109     | NULL |    1 |   100.00 | Using index condition |
+----+-------------+---------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+
1 row in set, 1 warning (0.01 sec)

mysql&gt; explain select * from test_tb where col1 = 1 and col2 like '%1' and col3 = 3;  -- like '%1%' æ‰§è¡Œåˆ†æç»“æœç›¸åŒ
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-----------------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref   | rows | filtered | Extra                 |
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-----------------------+
|  1 | SIMPLE      | test_tb | NULL       | ref  | idx1          | idx1 | 5       | const |    1 |    10.00 | Using index condition |
+----+-------------+---------+------------+------+---------------+------+---------+-------+------+----------+-----------------------+
1 row in set, 1 warning (0.01 sec)
</code></pre></div></div> <p>å¯ä»¥å‘ç°ï¼Œä½¿ç”¨å·¦åŒ¹é… <code class="language-plaintext highlighter-rouge">like '1'</code> ä¸ä¼šä¸­æ–­åŒ¹é…ç´¢å¼•ã€‚<code class="language-plaintext highlighter-rouge">like '%1'</code> å’Œ <code class="language-plaintext highlighter-rouge">like '%1%'</code> æ‰ä¼šä¸­æ–­åŒ¹é…ã€‚</p> <p>ä¹Ÿå°±æ˜¯è¯´<strong>æœ€å·¦åŒ¹é…åŸåˆ™ä¸å…‰æŒ‡è”åˆç´¢å¼•ä¸­çš„åˆ—ï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²ç´¢å¼•ä¸­çš„å­—ç¬¦ã€‚</strong></p> <p>å…¶ä»–æƒ…å†µï¼š</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; explain select * from test_tb where col1 = 1 or col2 = '2' and col3 = 3;   -- åˆ—é—´ä½¿ç”¨ or
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | test_tb | NULL       | ALL  | idx1          | NULL | NULL    | NULL |   10 |    10.90 | Using where |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

mysql&gt; explain select * from test_tb where col1 - 1 = 1 and col2 = '2' and col3 = 3;  -- åˆ—å‚ä¸è®¡ç®—
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | test_tb | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   10 |    10.00 | Using where |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

mysql&gt; explain select * from test_tb where date(col1) = 1 and col2 = '2' and col3 = 3;  -- åˆ—åŒ…å«åœ¨å‡½æ•°å¼é‡Œ
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | test_tb | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   10 |    10.00 | Using where |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.01 sec)
</code></pre></div></div> <div class="post-tags"> <nav class="nav-post-tags-list"> <ul class="tags"> <li><a href="/tag/database/">Database</a></li> <li><a href="/tag/mysql/">Mysql</a></li> <li><a href="/tag/index/">Index</a></li> </ul> </nav> </div> </main> <footer> <hr class="footer-hr"> <div class="ui-flex"> <div class='wrapper-footer'> Â© 2023 LanKE.e å©ªæ­Œ | <a href="mailto:dr.xx.yvens@gmail.com">Yven Fong</a> </div> </div> </footer> </div> </body> </html>
